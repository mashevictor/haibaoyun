# 性能优化和测试使用说明

## 快速开始

### 方法1: 一键执行（推荐）

```bash
批量压缩和测试.bat
```

这个脚本会自动：
1. 检查并安装依赖
2. 压缩所有图片和视频
3. 更新HTML文件中的图片路径
4. 启动服务器并运行性能测试

### 方法2: 分步执行

#### 步骤1: 压缩媒体文件

```bash
python compress_media.py
```

压缩后的文件保存在：
- `images/compressed/` - 压缩后的图片
- `video/compressed/` - 压缩后的视频

#### 步骤2: 更新HTML路径

```bash
python update_image_paths.py
```

这个脚本会自动更新所有HTML文件中的图片路径，指向压缩后的文件。

#### 步骤3: 运行性能测试

```bash
# 启动服务器（在另一个终端）
python -m http.server 8000

# 运行测试
npm run test:performance
```

## 压缩配置

### 图片压缩设置

- **质量**: 80% (可在 `compress_media.py` 中修改 `image_quality` 参数)
- **最大尺寸**: 1920x1080 (可在 `compress_media.py` 中修改 `max_size` 参数)
- **格式转换**: PNG自动转换为JPG以减小文件大小

### 视频压缩设置

- **CRF值**: 28 (可在 `compress_media.py` 中修改 `video_crf` 参数)
  - 值越大，压缩率越高，但质量越低
  - 推荐范围: 23-28
- **需要**: ffmpeg (可选，如果未安装会跳过视频压缩)

## 测试内容

### 1. 页面加载速度测试

测试所有主要页面的加载时间，目标：**< 1秒**

测试页面包括：
- 首页
- 所有产品页面（9个）
- 应用场景页面
- RWA钱包页面
- 关于我们页面

### 2. 多语言切换测试

测试5种语言的切换功能：
- 简体中文 (zh-CN)
- 繁体中文 (zh-TW)
- English (en)
- 日本語 (ja)
- 한국어 (ko)

### 3. 导航菜单测试

验证所有页面的导航菜单包含完整的9个产品项：
1. PowerVerse Chain
2. PowerVerse Infra
3. PowerVerse Market
4. PowerVerse DAO
5. PowerVerse Wallet
6. PowerVerse Scan
7. RWA代币 XAI
8. DeCloud
9. 算力港

### 4. 多语言导航测试

测试每种语言下的导航菜单是否正确显示。

## 查看测试结果

测试完成后，查看报告：

1. **HTML报告**（推荐）:
   ```
   playwright-report-performance/index.html
   ```
   在浏览器中打开，查看详细的测试结果和性能数据。

2. **JSON结果**:
   ```
   test-results/performance-results.json
   ```
   包含结构化的测试数据，可用于进一步分析。

## 优化建议

如果页面加载时间超过1秒，可以尝试：

### 1. 进一步压缩图片

修改 `compress_media.py` 中的 `image_quality` 参数：
```python
image_results = process_directory(images_dir, output_dir=compressed_dir, image_quality=70)  # 从80降到70
```

### 2. 使用WebP格式

WebP格式压缩率更高，但需要浏览器支持。可以修改压缩脚本支持WebP。

### 3. 延迟加载（Lazy Loading）

对非首屏图片使用懒加载：
```html
<img src="image.jpg" loading="lazy" alt="...">
```

### 4. CDN加速

使用CDN分发静态资源，可以显著提升加载速度。

### 5. 启用Gzip压缩

在服务器端启用Gzip压缩，可以减小传输文件大小。

## 注意事项

1. **备份原文件**: 压缩会创建新文件，原文件不会被删除，但建议先备份
2. **PNG转JPG**: PNG文件会转换为JPG，透明度信息会丢失（使用白色背景）
3. **视频压缩**: 需要ffmpeg，如果没有安装会跳过视频压缩
4. **服务器端口**: 测试需要服务器运行在 `http://localhost:8000`
5. **首次运行**: 首次运行测试会自动下载Playwright浏览器（约300MB）

## 故障排除

### 图片压缩失败

**问题**: `ModuleNotFoundError: No module named 'PIL'`

**解决**: 
```bash
pip install Pillow
```

### 视频压缩失败

**问题**: `ffmpeg not found`

**解决**: 
- Windows: 下载并安装 [ffmpeg](https://ffmpeg.org/download.html)
- 或跳过视频压缩（不影响图片压缩和测试）

### 测试失败

**问题**: `Error: net::ERR_CONNECTION_REFUSED`

**解决**: 
确保服务器正在运行：
```bash
python -m http.server 8000
```

### 路径更新失败

**问题**: HTML文件中的图片路径未更新

**解决**: 
1. 检查压缩后的文件是否存在
2. 手动检查HTML文件中的路径
3. 如果PNG转JPG，确保路径也更新为.jpg

## 文件结构

```
项目根目录/
├── compress_media.py          # 压缩脚本
├── update_image_paths.py      # 路径更新脚本
├── run_performance_test.py    # 测试运行脚本
├── 批量压缩和测试.bat          # Windows批处理文件
├── tests/
│   └── performance.spec.js     # 性能测试用例
├── playwright.config.performance.js  # 测试配置
├── images/
│   ├── compressed/            # 压缩后的图片
│   └── ...
├── video/
│   ├── compressed/            # 压缩后的视频
│   └── ...
└── playwright-report-performance/    # 测试报告
```

## 联系支持

如果遇到问题，请检查：
1. Python版本 >= 3.7
2. Node.js版本 >= 16
3. 所有依赖已正确安装
4. 服务器正在运行
