<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»šåŠ¨äº¤äº’æµ‹è¯• - PowerVerse Chain</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .test-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 450px;
            max-height: 85vh;
            background: rgba(10, 14, 39, 0.98);
            border: 2px solid rgba(0, 212, 255, 0.5);
            border-radius: 12px;
            padding: 20px;
            z-index: 10000;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
        }
        .test-panel h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 10px;
        }
        .test-btn {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.5);
            color: #00d4ff;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 0.9rem;
        }
        .test-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }
        .test-btn.running {
            background: rgba(255, 165, 0, 0.2);
            border-color: #ffa500;
            color: #ffa500;
        }
        .test-log {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            margin-top: 15px;
        }
        .log-entry {
            margin: 4px 0;
            padding: 4px;
            border-left: 3px solid transparent;
            padding-left: 8px;
        }
        .log-entry.pass { 
            color: #00ff00; 
            border-left-color: #00ff00;
        }
        .log-entry.fail { 
            color: #ff0000; 
            border-left-color: #ff0000;
        }
        .log-entry.warning { 
            color: #ffaa00; 
            border-left-color: #ffaa00;
        }
        .log-entry.info { 
            color: #00d4ff; 
            border-left-color: #00d4ff;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .stat-item {
            background: rgba(0, 212, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4ff;
        }
        .stat-label {
            font-size: 0.75rem;
            color: #a0aec0;
            margin-top: 5px;
        }
        .scroll-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.5);
            padding: 10px 15px;
            border-radius: 6px;
            color: #00d4ff;
            font-size: 0.85rem;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <!-- æ»šåŠ¨æŒ‡ç¤ºå™¨ -->
    <div class="scroll-indicator" id="scrollIndicator">
        æ»šåŠ¨ä½ç½®: <span id="scrollPos">0</span>px
    </div>
    
    <!-- æµ‹è¯•é¢æ¿ -->
    <div class="test-panel" id="testPanel">
        <h3>ğŸ”„ Ralph Loop æ»šåŠ¨äº¤äº’æµ‹è¯•</h3>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="statTotal">0</div>
                <div class="stat-label">æ€»æµ‹è¯•</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statPassed">0</div>
                <div class="stat-label">é€šè¿‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statFailed">0</div>
                <div class="stat-label">å¤±è´¥</div>
            </div>
        </div>
        
        <button class="test-btn" onclick="startRalphLoopTest()">ğŸš€ å¼€å§‹ Ralph Loop æµ‹è¯•</button>
        <button class="test-btn" onclick="testScrollAndClick()">ğŸ“œ æµ‹è¯•æ»šåŠ¨åç‚¹å‡»</button>
        <button class="test-btn" onclick="testMultipleScrolls()">ğŸ”„ å¤šæ¬¡æ»šåŠ¨æµ‹è¯•</button>
        <button class="test-btn" onclick="testRealUserScenario()">ğŸ‘¤ çœŸå®ç”¨æˆ·åœºæ™¯</button>
        <button class="test-btn" onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        
        <div class="test-log" id="testLog"></div>
    </div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <a href="index.html">
                        <div class="logo-icon">P</div>
                        <span>PowerVerse Chain</span>
                    </a>
                </div>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="index.html#product" data-i18n="nav.product">äº§å“</a></li>
                    <li><a href="pages/scenarios.html" data-i18n="nav.scenario">åº”ç”¨åœºæ™¯</a></li>
                    <li><a href="pages/developer.html" data-i18n="nav.developer">å¼€å‘è€…ä¸­å¿ƒ</a></li>
                    <li><a href="pages/token.html" data-i18n="nav.token">ä»£å¸</a></li>
                    <li><a href="pages/hardware-factory.html" data-i18n="nav.hardwareFactory">ç¡¬ä»¶å·¥å‚</a></li>
                    <li><a href="pages/research-strength.html" data-i18n="nav.researchStrength">ç ”å‘å®åŠ›</a></li>
                    <li><a href="pages/about.html" data-i18n="nav.about">å…³äºæˆ‘ä»¬</a></li>
                </ul>
                <div class="nav-actions">
                    <button class="lang-switch">ç®€ä½“ä¸­æ–‡</button>
                    <button class="menu-toggle" id="menuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- é•¿å†…å®¹åŒºåŸŸï¼Œç”¨äºæµ‹è¯•æ»šåŠ¨ -->
    <div style="padding-top: 100px; min-height: 3000px; background: var(--bg-darker);">
        <div class="container">
            <section style="padding: 4rem 0;">
                <h1 data-i18n="home.title" style="text-align: center; margin-bottom: 2rem; font-size: 3rem;">PowerVerse Chain</h1>
                <p data-i18n="home.description" style="text-align: center; max-width: 800px; margin: 0 auto 3rem; font-size: 1.2rem;">æ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼è®¡ç®—åŸºç¡€è®¾æ–½</p>
            </section>
            
            <section style="padding: 4rem 0; margin: 4rem 0;">
                <div class="section-header">
                    <h2 data-i18n="architecture.title" style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem;">æŠ€æœ¯æ¡†æ¶</h2>
                </div>
                <div style="background: var(--card-bg); padding: 3rem; border-radius: 20px; margin: 2rem 0;">
                    <h3 data-i18n="architecture.appLayer" style="color: var(--primary-color); margin-bottom: 1rem;">åº”ç”¨å±‚</h3>
                    <p>åº”ç”¨å±‚åŒ…å«å„ç§å»ä¸­å¿ƒåŒ–åº”ç”¨å’ŒAPIæ¥å£ã€‚</p>
                </div>
                <div style="background: var(--card-bg); padding: 3rem; border-radius: 20px; margin: 2rem 0;">
                    <h3 data-i18n="architecture.protocolLayer" style="color: var(--primary-color); margin-bottom: 1rem;">åè®®å±‚</h3>
                    <p>åè®®å±‚æä¾›å…±è¯†æœºåˆ¶å’Œæ™ºèƒ½åˆçº¦åŠŸèƒ½ã€‚</p>
                </div>
                <div style="background: var(--card-bg); padding: 3rem; border-radius: 20px; margin: 2rem 0;">
                    <h3 data-i18n="architecture.networkLayer" style="color: var(--primary-color); margin-bottom: 1rem;">ç½‘ç»œå±‚</h3>
                    <p>ç½‘ç»œå±‚ç®¡ç†P2Pç½‘ç»œå’ŒèŠ‚ç‚¹é€šä¿¡ã€‚</p>
                </div>
            </section>
            
            <section style="padding: 4rem 0; margin: 4rem 0;">
                <h2 data-i18n="products.title" style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem;">äº§å“ç”Ÿæ€ç³»ç»Ÿ</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div style="background: var(--card-bg); padding: 2rem; border-radius: 20px;">
                        <h3>PowerVerse Chain</h3>
                        <p>é«˜æ€§èƒ½åŒºå—é“¾åŸºç¡€è®¾æ–½</p>
                    </div>
                    <div style="background: var(--card-bg); padding: 2rem; border-radius: 20px;">
                        <h3>PowerVerse Infra</h3>
                        <p>åŸºç¡€è®¾æ–½æœåŠ¡</p>
                    </div>
                    <div style="background: var(--card-bg); padding: 2rem; border-radius: 20px;">
                        <h3>PowerVerse Market</h3>
                        <p>å»ä¸­å¿ƒåŒ–å¸‚åœº</p>
                    </div>
                </div>
            </section>
            
            <section style="padding: 4rem 0; margin: 4rem 0; min-height: 500px;">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem;">æ›´å¤šå†…å®¹åŒºåŸŸ</h2>
                <p style="text-align: center; font-size: 1.2rem; color: var(--text-secondary);">ç»§ç»­æ»šåŠ¨ä»¥æµ‹è¯•è¯­è¨€æŒ‰é’®åŠŸèƒ½</p>
            </section>
        </div>
    </div>
    
    <!-- åŠ è½½è„šæœ¬ -->
    <script src="js/languages.js"></script>
    <script src="script.js"></script>
    
    <script>
        let testStats = { total: 0, passed: 0, failed: 0 };
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateStats() {
            document.getElementById('statTotal').textContent = testStats.total;
            document.getElementById('statPassed').textContent = testStats.passed;
            document.getElementById('statFailed').textContent = testStats.failed;
        }
        
        function addResult(passed, message) {
            testStats.total++;
            if (passed) {
                testStats.passed++;
                log(`âœ“ ${message}`, 'pass');
            } else {
                testStats.failed++;
                log(`âœ— ${message}`, 'fail');
            }
            updateStats();
        }
        
        function clearLog() {
            testStats = { total: 0, passed: 0, failed: 0 };
            document.getElementById('testLog').innerHTML = '';
            updateStats();
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function updateScrollIndicator() {
            const scrollPos = window.pageYOffset || document.documentElement.scrollTop;
            document.getElementById('scrollPos').textContent = Math.round(scrollPos);
        }
        
        // ç›‘å¬æ»šåŠ¨
        window.addEventListener('scroll', updateScrollIndicator);
        updateScrollIndicator();
        
        // æ¨¡æ‹ŸçœŸå®ç‚¹å‡»
        async function simulateRealClick(element) {
            if (!element) return false;
            
            // æ–¹æ³•1: ç›´æ¥è°ƒç”¨ç‚¹å‡»æ–¹æ³•
            try {
                element.click();
                await sleep(100);
                return true;
            } catch (e) {
                console.warn('ç›´æ¥clickå¤±è´¥:', e);
            }
            
            // æ–¹æ³•2: åˆ†å‘é¼ æ ‡äº‹ä»¶
            try {
                const events = [
                    new MouseEvent('mousedown', { bubbles: true, cancelable: true }),
                    new MouseEvent('mouseup', { bubbles: true, cancelable: true }),
                    new MouseEvent('click', { bubbles: true, cancelable: true })
                ];
                
                for (const event of events) {
                    element.dispatchEvent(event);
                    await sleep(50);
                }
                return true;
            } catch (e) {
                console.warn('äº‹ä»¶åˆ†å‘å¤±è´¥:', e);
            }
            
            // æ–¹æ³•3: ç›´æ¥è°ƒç”¨è¯­è¨€ç®¡ç†å™¨æ–¹æ³•
            if (window.languageManager && window.languageManager.showLanguageMenu) {
                try {
                    window.languageManager.showLanguageMenu();
                    await sleep(100);
                    return true;
                } catch (e) {
                    console.warn('ç›´æ¥è°ƒç”¨æ–¹æ³•å¤±è´¥:', e);
                }
            }
            
            return false;
        }
        
        async function testButtonAfterScroll(scrollPosition) {
            log(`æµ‹è¯•: æ»šåŠ¨åˆ° ${scrollPosition}px åç‚¹å‡»æŒ‰é’®`, 'info');
            
            // æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®
            window.scrollTo({
                top: scrollPosition,
                behavior: 'smooth'
            });
            await sleep(800); // ç­‰å¾…æ»šåŠ¨å®Œæˆ
            
            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å­˜åœ¨
            const btn = document.querySelector('.lang-switch');
            if (!btn) {
                addResult(false, `æ»šåŠ¨åˆ° ${scrollPosition}px åæŒ‰é’®ä¸å­˜åœ¨`);
                return false;
            }
            
            // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯è§
            const rect = btn.getBoundingClientRect();
            const isVisible = rect.top >= 0 && rect.left >= 0 && 
                            rect.bottom <= window.innerHeight && 
                            rect.right <= window.innerWidth;
            
            if (!isVisible && scrollPosition > 200) {
                log(`æŒ‰é’®åœ¨è§†å£å¤– (top: ${rect.top}px)`, 'warning');
            }
            
            // å°è¯•ç‚¹å‡»æŒ‰é’®
            const clickSuccess = await simulateRealClick(btn);
            await sleep(300);
            
            // æ£€æŸ¥èœå•æ˜¯å¦æ˜¾ç¤º
            const menu = document.getElementById('language-menu');
            const menuVisible = menu && menu.style.display === 'block';
            
            if (menuVisible) {
                addResult(true, `æ»šåŠ¨åˆ° ${scrollPosition}px åæŒ‰é’®å¯ç”¨`);
                menu.style.display = 'none';
                return true;
            } else {
                addResult(false, `æ»šåŠ¨åˆ° ${scrollPosition}px åæŒ‰é’®å¤±æ•ˆ (ç‚¹å‡»æˆåŠŸ: ${clickSuccess})`);
                return false;
            }
        }
        
        async function testScrollAndClick() {
            clearLog();
            log('å¼€å§‹æµ‹è¯•æ»šåŠ¨åç‚¹å‡»...', 'info');
            
            const scrollPositions = [0, 500, 1000, 1500, 2000, 2500];
            
            for (const pos of scrollPositions) {
                await testButtonAfterScroll(pos);
                await sleep(500);
            }
            
            log('æ»šåŠ¨æµ‹è¯•å®Œæˆ', 'info');
        }
        
        async function testMultipleScrolls() {
            clearLog();
            log('å¼€å§‹å¤šæ¬¡æ»šåŠ¨æµ‹è¯•ï¼ˆRalph Loopï¼‰...', 'info');
            
            // å¾ªç¯æµ‹è¯•10æ¬¡
            for (let i = 1; i <= 10; i++) {
                log(`--- ç¬¬ ${i} æ¬¡å¾ªç¯ ---`, 'info');
                
                // éšæœºæ»šåŠ¨ä½ç½®
                const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
                const randomScroll = Math.floor(Math.random() * maxScroll);
                
                await testButtonAfterScroll(randomScroll);
                await sleep(500);
                
                // æ»šåŠ¨å›é¡¶éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
                await sleep(500);
                
                await testButtonAfterScroll(0);
                await sleep(500);
            }
            
            log('å¤šæ¬¡æ»šåŠ¨æµ‹è¯•å®Œæˆ', 'info');
        }
        
        async function testRealUserScenario() {
            clearLog();
            log('å¼€å§‹çœŸå®ç”¨æˆ·åœºæ™¯æµ‹è¯•...', 'info');
            
            const scenarios = [
                { name: 'å¿«é€Ÿæ»šåŠ¨åˆ°åº•éƒ¨', scroll: () => document.documentElement.scrollHeight - window.innerHeight },
                { name: 'æ»šåŠ¨åˆ°ä¸­é—´', scroll: () => (document.documentElement.scrollHeight - window.innerHeight) / 2 },
                { name: 'æ»šåŠ¨åˆ°1/4ä½ç½®', scroll: () => (document.documentElement.scrollHeight - window.innerHeight) / 4 },
                { name: 'æ»šåŠ¨åˆ°3/4ä½ç½®', scroll: () => (document.documentElement.scrollHeight - window.innerHeight) * 3 / 4 },
            ];
            
            for (const scenario of scenarios) {
                log(`åœºæ™¯: ${scenario.name}`, 'info');
                const scrollPos = scenario.scroll();
                await testButtonAfterScroll(scrollPos);
                await sleep(1000);
            }
            
            log('çœŸå®ç”¨æˆ·åœºæ™¯æµ‹è¯•å®Œæˆ', 'info');
        }
        
        async function startRalphLoopTest() {
            clearLog();
            log('ğŸš€ å¼€å§‹ Ralph Loop å…¨é‡æµ‹è¯•...', 'info');
            
            // æµ‹è¯•1: åˆå§‹çŠ¶æ€
            log('æµ‹è¯•1: åˆå§‹çŠ¶æ€æŒ‰é’®', 'info');
            await testButtonAfterScroll(0);
            await sleep(500);
            
            // æµ‹è¯•2: æ»šåŠ¨åç‚¹å‡»ï¼ˆå¤šæ¬¡ï¼‰
            log('æµ‹è¯•2: æ»šåŠ¨åç‚¹å‡»æµ‹è¯•', 'info');
            await testScrollAndClick();
            await sleep(500);
            
            // æµ‹è¯•3: å¤šæ¬¡æ»šåŠ¨å¾ªç¯
            log('æµ‹è¯•3: å¤šæ¬¡æ»šåŠ¨å¾ªç¯æµ‹è¯•', 'info');
            await testMultipleScrolls();
            await sleep(500);
            
            // æµ‹è¯•4: çœŸå®ç”¨æˆ·åœºæ™¯
            log('æµ‹è¯•4: çœŸå®ç”¨æˆ·åœºæ™¯æµ‹è¯•', 'info');
            await testRealUserScenario();
            
            log('âœ… Ralph Loop æµ‹è¯•å®Œæˆï¼', 'pass');
            log(`æ€»è®¡: ${testStats.total} ä¸ªæµ‹è¯•, é€šè¿‡: ${testStats.passed}, å¤±è´¥: ${testStats.failed}`, 
                testStats.failed === 0 ? 'pass' : 'fail');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('æµ‹è¯•ç³»ç»Ÿå·²åŠ è½½', 'info');
                log('ç­‰å¾…è¯­è¨€ç®¡ç†å™¨åˆå§‹åŒ–...', 'info');
                
                // ç­‰å¾…è¯­è¨€ç®¡ç†å™¨
                let retries = 0;
                const checkManager = setInterval(() => {
                    retries++;
                    if (window.languageManager) {
                        clearInterval(checkManager);
                        log('âœ“ è¯­è¨€ç®¡ç†å™¨å·²åˆå§‹åŒ–', 'pass');
                    } else if (retries > 20) {
                        clearInterval(checkManager);
                        log('âœ— è¯­è¨€ç®¡ç†å™¨åˆå§‹åŒ–è¶…æ—¶', 'fail');
                    }
                }, 100);
            }, 500);
        });
    </script>
</body>
</html>
