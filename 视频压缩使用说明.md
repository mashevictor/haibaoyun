# 视频压缩工具使用说明

## 📋 目录
1. [安装 FFmpeg](#安装-ffmpeg)
2. [压缩视频](#压缩视频)
3. [高级用法](#高级用法)
4. [常见问题](#常见问题)

---

## 🔧 安装 FFmpeg

### 方法一：使用 Python 脚本自动安装（推荐）

1. 打开命令提示符或 PowerShell
2. 进入当前目录
3. 运行以下命令：

```bash
python install_ffmpeg.py
```

### 方法二：手动安装

1. **下载 FFmpeg**
   - 访问：https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip
   - 下载完整的 ZIP 文件

2. **解压并安装**
   - 将下载的 `ffmpeg-release-essentials.zip` 解压
   - 将解压后的文件夹重命名为 `ffmpeg`
   - 将整个文件夹移动到 `C:\` 驱动器根目录（最终路径：`C:\ffmpeg`）

3. **添加到系统 PATH**
   - 右键点击"此电脑"（或"我的电脑"）
   - 选择"属性"
   - 点击"高级系统设置"
   - 点击"环境变量"按钮
   - 在"用户变量"部分找到"Path"变量，双击编辑
   - 点击"新建"按钮
   - 输入：`C:\ffmpeg\bin`
   - 点击"确定"保存所有设置

4. **验证安装**
   - 打开**新的**命令提示符窗口（必须是新窗口）
   - 运行以下命令：
   
   ```bash
   ffmpeg -version
   ```
   
   - 如果显示 FFmpeg 的版本信息，说明安装成功！

### 方法三：使用批处理文件

双击运行 `install-ffmpeg.bat` 文件，按照提示完成安装。

---

## 🎬 压缩视频

安装好 FFmpeg 后，有三种方式压缩视频：

### 方式一：拖放方式（最简单）

1. 找到 `压缩视频.bat` 文件
2. 将要压缩的视频文件**拖放**到 `压缩视频.bat` 上
3. 等待压缩完成
4. 压缩后的视频会保存在原文件同目录，文件名末尾会加上 `_compressed`

**示例：**
- 原文件：`我的视频.mp4`
- 压缩后：`我的视频_compressed.mp4`

### 方式二：使用 Python 脚本

**基本用法：**

```bash
python compress_video.py 视频文件.mp4
```

**指定输出文件名：**

```bash
python compress_video.py 输入视频.mp4 -o 输出视频.mp4
```

**压缩到不同比例：**

```bash
# 压缩到原来的 1/3 大小
python compress_video.py 视频文件.mp4 -r 0.33

# 压缩到原来的 1/4 大小
python compress_video.py 视频文件.mp4 -r 0.25
```

**调整质量：**

```bash
# 使用更高质量（CRF=20，质量更好但文件更大）
python compress_video.py 视频文件.mp4 --crf 20

# 使用更低质量（CRF=28，质量较低但文件更小）
python compress_video.py 视频文件.mp4 --crf 28
```

### 方式三：直接使用 FFmpeg 命令

**压缩到约 1/2 大小（推荐质量）：**

```bash
ffmpeg -i 输入视频.mp4 -c:v libx264 -crf 25 -preset medium -c:a aac -b:a 128k -movflags +faststart 输出视频.mp4
```

**更高质量（文件稍大）：**

```bash
ffmpeg -i 输入视频.mp4 -c:v libx264 -crf 23 -preset slow -c:a aac -b:a 192k -movflags +faststart 输出视频.mp4
```

**更小文件（质量稍低）：**

```bash
ffmpeg -i 输入视频.mp4 -c:v libx264 -crf 28 -preset fast -c:a aac -b:a 96k -movflags +faststart 输出视频.mp4
```

---

## 🎯 高级用法

### CRF 质量参数说明

CRF（Constant Rate Factor）是 FFmpeg 的质量控制参数：

- **CRF 18-20**：非常高的质量，文件较大，几乎无损
- **CRF 21-23**：高质量，推荐用于高清视频
- **CRF 24-26**：中等质量，文件大小适中（**默认推荐**）
- **CRF 27-28**：较低质量，文件更小，适合网络传输
- **CRF 29+**：低质量，不推荐使用

### 预设速度参数

`-preset` 参数控制编码速度和压缩率：

- **ultrafast**：最快，但压缩率最低
- **fast**：较快，压缩率一般
- **medium**：中等速度，压缩率适中（**默认推荐**）
- **slow**：较慢，压缩率较高
- **veryslow**：最慢，但压缩率最高

### 批量压缩多个视频

创建一个批处理文件来批量处理：

```batch
@echo off
for %%f in (*.mp4) do (
    echo 正在压缩: %%f
    ffmpeg -i "%%f" -c:v libx264 -crf 25 -preset medium -c:a aac -b:a 128k "%%~nf_compressed.mp4"
)
echo 所有视频压缩完成！
pause
```

保存为 `批量压缩.bat`，放在视频文件所在目录，双击运行。

### 压缩特定分辨率

**压缩到 1080p：**

```bash
ffmpeg -i 输入.mp4 -vf scale=1920:1080 -c:v libx264 -crf 23 -preset medium -c:a aac -b:a 128k 输出.mp4
```

**压缩到 720p：**

```bash
ffmpeg -i 输入.mp4 -vf scale=1280:720 -c:v libx264 -crf 23 -preset medium -c:a aac -b:a 128k 输出.mp4
```

---

## ❓ 常见问题

### 1. 提示 "ffmpeg 不是内部或外部命令"

**原因：** FFmpeg 未正确安装或未添加到系统 PATH。

**解决方法：**
- 确认 FFmpeg 已安装到 `C:\ffmpeg`
- 确认已将 `C:\ffmpeg\bin` 添加到系统 PATH
- **重新打开命令提示符窗口**（重要！）
- 再次运行 `ffmpeg -version` 验证

### 2. 压缩后文件太大或太小

**解决方法：**
- 文件太大：增加 CRF 值（如 `--crf 28`）
- 文件太小：减少 CRF 值（如 `--crf 20`）
- 使用 `-r` 参数调整目标比例

### 3. 压缩后视频质量下降明显

**解决方法：**
- 使用更低的 CRF 值（如 `--crf 20`）
- 使用更慢的预设（`-preset slow`）
- 考虑只降低分辨率而不是降低质量

### 4. 压缩速度很慢

**解决方法：**
- 使用更快的预设（`-preset fast`）
- 注意：更快的预设会导致文件稍大
- 对于大文件，压缩需要时间是正常的

### 5. 音频没有声音

**解决方法：**
- 确保命令中包含 `-c:a aac` 参数
- 检查原视频是否有音频
- 尝试使用 `-c:a copy` 直接复制原音频

### 6. 压缩后无法播放

**解决方法：**
- 使用 `-movflags +faststart` 参数（已包含在示例中）
- 确保使用的是兼容的编码格式（H.264 + AAC）
- 更新播放器到最新版本

---

## 📊 压缩效果参考

以下是不同 CRF 值的压缩效果参考（实际效果因视频内容而异）：

| CRF 值 | 预期文件大小 | 质量 | 推荐用途 |
|--------|-------------|------|----------|
| 18-20  | 70-80%      | 极高 | 专业视频、归档 |
| 21-23  | 50-70%      | 高   | 高清视频分享 |
| 24-26  | 40-50%      | 中高 | 日常使用、网络分享 |
| 27-28  | 30-40%      | 中   | 网络传输、存储空间有限 |

---

## 🔗 相关资源

- [FFmpeg 官方网站](https://ffmpeg.org/)
- [FFmpeg 官方文档](https://ffmpeg.org/documentation.html)
- [H.264 编码指南](https://trac.ffmpeg.org/wiki/Encode/H.264)

---

## 📝 更新日志

- **2026-01-22**：创建初始版本
  - 添加 FFmpeg 安装脚本
  - 添加视频压缩脚本
  - 创建使用说明文档

---

**需要帮助？** 遇到问题请检查上面的"常见问题"部分，或参考 FFmpeg 官方文档。
