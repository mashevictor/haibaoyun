# 🎬 网站视频压缩使用说明

## 快速开始

### 一键完成所有操作（推荐）

**双击运行：** `一键压缩并测试.bat`

这会自动完成：
1. ✅ 压缩 video 文件夹中的所有视频
2. ✅ 启动本地 HTTP 服务器
3. ✅ 在浏览器中打开测试页面
4. ✅ 对比压缩前后的效果

---

## 压缩参数说明

### 优化策略

本脚本专门针对网站优化，采用以下策略：

| 参数 | 值 | 说明 |
|------|-----|------|
| **编码格式** | H.264 | 最佳浏览器兼容性 |
| **压缩质量** | CRF 28 | 高压缩率，文件更小 |
| **编码速度** | slow | 慢速编码，获得更好压缩 |
| **最大码率** | 2 Mbps | 限制最大比特率 |
| **音频码率** | 96 kbps | 降低音频大小 |
| **快速启动** | faststart | 支持边下载边播放 |
| **视频尺寸** | **保持不变** | 不改变分辨率 |

### 压缩效果预期

- **文件大小**：通常减小 60-80%
- **质量损失**：肉眼几乎无法察觉
- **加载速度**：提升 2-5 倍
- **兼容性**：所有现代浏览器

---

## 使用方法

### 方法 1：一键执行（最简单）

```bash
双击运行: 一键压缩并测试.bat
```

### 方法 2：只压缩视频

```bash
双击运行: 压缩网站视频.py
```

或在命令行：

```bash
python 压缩网站视频.py
```

### 方法 3：压缩后启动服务

```bash
双击运行: 压缩并启动.bat
```

---

## 输出文件说明

压缩后的视频会保存在 `video` 文件夹中：

### 命名规则

- **原始文件**：`视频1.mp4`
- **压缩文件**：`视频1_web.mp4`

### 建议使用

在网站中，建议使用压缩后的 `_web.mp4` 版本：

```html
<!-- 使用压缩版本 -->
<video src="video/视频1_web.mp4" controls></video>

<!-- 或使用 source 标签 -->
<video controls>
  <source src="video/视频1_web.mp4" type="video/mp4">
</video>
```

---

## 测试页面

### 访问测试页面

启动服务后，访问：
```
http://localhost:8000/测试视频加载.html
```

### 测试页面功能

- ✅ 并排对比原始和压缩版本
- ✅ 显示文件大小对比
- ✅ 显示加载时间对比
- ✅ 显示压缩比例
- ✅ 实时播放测试

---

## 压缩参数自定义

如果需要调整压缩参数，可以修改 `压缩网站视频.py` 中的这些值：

### CRF 值（影响质量和大小）

```python
'-crf', '28',  # 范围: 18-28
```

- **18-20**：高质量，文件较大（压缩 30-40%）
- **23-25**：中高质量，文件适中（压缩 50-60%）
- **26-28**：可接受质量，文件更小（压缩 70-80%）
- **29+**：质量下降明显，不推荐

### 最大码率

```python
'-maxrate', '2M',  # 最大码率
```

- `1M`：极小文件，适合移动网络
- `2M`：推荐值，平衡质量和大小
- `3M`：高质量，文件稍大

### 音频码率

```python
'-b:a', '96k',  # 音频比特率
```

- `64k`：低质量，极小文件
- `96k`：推荐值，足够清晰
- `128k`：高质量，标准值

---

## 网站集成建议

### 1. 预加载视频

```html
<!-- 预加载元数据 -->
<video preload="metadata" src="video/视频1_web.mp4"></video>

<!-- 预加载部分内容 -->
<video preload="auto" src="video/视频1_web.mp4"></video>
```

### 2. 响应式视频

```html
<video style="width: 100%; height: auto;" controls>
  <source src="video/视频1_web.mp4" type="video/mp4">
</video>
```

### 3. 自动播放（静音）

```html
<video autoplay muted loop playsinline>
  <source src="video/视频1_web.mp4" type="video/mp4">
</video>
```

### 4. 懒加载

```html
<video loading="lazy" src="video/视频1_web.mp4"></video>
```

---

## 性能优化建议

### 1. 使用 CDN

将压缩后的视频上传到 CDN，获得更快的加载速度。

### 2. 根据网络选择

```javascript
// 根据网络速度选择视频版本
const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
const videoSrc = connection && connection.effectiveType === '4g' 
  ? 'video/视频1.mp4'  // 原始版本
  : 'video/视频1_web.mp4';  // 压缩版本
```

### 3. 添加 poster 图片

```html
<video poster="thumbnail.jpg" src="video/视频1_web.mp4"></video>
```

---

## 常见问题

### Q: 压缩会损失多少质量？

A: 使用 CRF 28，肉眼几乎无法察觉质量差异，但文件大小减小 70-80%。

### Q: 压缩后尺寸会改变吗？

A: 不会！脚本保持原始分辨率不变。

### Q: 支持哪些视频格式？

A: 目前支持 MP4 格式。其他格式可以先转换为 MP4。

### Q: 压缩需要多长时间？

A: 取决于视频大小和时长，通常 1 分钟视频需要 1-3 分钟压缩时间。

### Q: 可以批量压缩吗？

A: 可以！脚本会自动压缩 video 文件夹中的所有 MP4 文件。

---

## 文件清单

| 文件 | 说明 |
|------|------|
| `一键压缩并测试.bat` | 一键完成压缩+启动服务 |
| `压缩网站视频.py` | 核心压缩脚本 |
| `压缩并启动.bat` | 压缩后启动服务 |
| `测试视频加载.html` | 效果对比测试页面 |
| `视频压缩说明.md` | 本说明文档 |

---

## 技术细节

### FFmpeg 命令

```bash
ffmpeg -i input.mp4 \
  -c:v libx264 \
  -crf 28 \
  -preset slow \
  -profile:v main \
  -level 4.0 \
  -maxrate 2M \
  -bufsize 4M \
  -c:a aac \
  -b:a 96k \
  -ac 2 \
  -ar 44100 \
  -movflags +faststart \
  -pix_fmt yuv420p \
  output_web.mp4
```

### 参数解释

- `-c:v libx264`：使用 H.264 视频编码器
- `-crf 28`：恒定质量因子
- `-preset slow`：编码预设
- `-maxrate 2M`：最大比特率限制
- `-movflags +faststart`：优化网络播放
- `-pix_fmt yuv420p`：像素格式（兼容性）

---

## 更新日志

- **2026-01-22**：
  - ✅ 创建网站视频压缩工具
  - ✅ 添加一键压缩和启动功能
  - ✅ 创建效果对比测试页面
  - ✅ 优化压缩参数用于网站加载

---

**需要帮助？** 参考 FFmpeg 官方文档：https://ffmpeg.org/documentation.html
