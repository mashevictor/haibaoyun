# 页面性能优化和测试指南

## 概述

本指南介绍如何压缩图片和视频，以及如何测试页面加载速度和多语言切换功能。

## 功能

1. **媒体文件压缩**: 自动压缩所有图片和视频文件
2. **性能测试**: 测试每个页面的加载速度（目标：<1秒）
3. **多语言测试**: 测试所有语言版本的页面加载和切换

## 快速开始

### 方法1: 使用批处理文件（Windows）

```bash
run_performance_test.bat
```

### 方法2: 使用Python脚本

```bash
python run_performance_test.py
```

### 方法3: 手动执行

#### 步骤1: 压缩媒体文件

```bash
# 安装依赖
pip install -r requirements.txt

# 运行压缩脚本
python compress_media.py
```

压缩后的文件将保存在 `images/compressed/` 和 `video/compressed/` 目录中。

#### 步骤2: 更新HTML文件中的图片路径

压缩后，需要更新HTML文件中的图片路径指向压缩后的文件。

#### 步骤3: 运行性能测试

```bash
# 启动服务器（在另一个终端）
python -m http.server 8000

# 运行测试
npm run test:performance
```

## 压缩配置

### 图片压缩

- **质量**: 80% (可在 `compress_media.py` 中调整)
- **最大尺寸**: 1920x1080 (可在 `compress_media.py` 中调整)
- **格式**: PNG自动转换为JPG以减小文件大小

### 视频压缩

- **CRF值**: 28 (可在 `compress_media.py` 中调整，值越大压缩率越高)
- **需要**: ffmpeg (可选，如果未安装会跳过视频压缩)

## 测试配置

### 性能目标

- **最大加载时间**: 1000ms (1秒)
- **测试页面**: 所有主要页面
- **测试语言**: 5种语言（简体中文、繁体中文、英文、日文、韩文）

### 测试内容

1. **页面加载速度**: 测试每个页面从导航到完全加载的时间
2. **多语言切换**: 测试语言切换按钮的功能
3. **导航菜单**: 验证所有9个产品项都正确显示
4. **多语言导航**: 测试每种语言下的导航菜单

## 测试报告

测试完成后，查看报告：

- **HTML报告**: `playwright-report-performance/index.html`
- **JSON结果**: `test-results/performance-results.json`

## 优化建议

如果页面加载时间超过1秒，可以尝试：

1. **进一步压缩图片**: 降低质量参数（如从80降到70）
2. **使用WebP格式**: 现代浏览器支持，压缩率更高
3. **延迟加载**: 对非首屏图片使用懒加载
4. **CDN加速**: 使用CDN分发静态资源
5. **Gzip压缩**: 在服务器端启用Gzip压缩

## 注意事项

1. 压缩会覆盖原文件，建议先备份
2. 视频压缩需要ffmpeg，如果没有安装会跳过
3. 测试需要服务器运行在 `http://localhost:8000`
4. 首次运行测试会自动安装Playwright浏览器

## 故障排除

### 图片压缩失败

- 检查Pillow是否正确安装: `pip install Pillow`
- 检查图片文件是否损坏

### 视频压缩失败

- 安装ffmpeg: https://ffmpeg.org/download.html
- 或跳过视频压缩（不影响测试）

### 测试失败

- 确保服务器正在运行: `python -m http.server 8000`
- 检查端口8000是否被占用
- 查看测试报告了解详细错误信息
